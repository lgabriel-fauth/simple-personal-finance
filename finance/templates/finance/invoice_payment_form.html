{% extends 'finance/base.html' %}
{% load finance_filters %}
{% block title %}Pagamento da Fatura{% endblock %}
{% block content %}
<h1 class="h3 mb-3">Pagamento da Fatura</h1>
<form method="post" class="card card-body">
  {% csrf_token %}
  <div class="mb-3">
    <label class="form-label" for="id_kind">Tipo</label>
    {{ form.kind }}
  </div>
  <div class="mb-3" id="account-field">
    <label class="form-label" for="id_account">Conta para pagar</label>
    {{ form.account }}
  </div>
  <div class="mb-3">
    <label class="form-label" for="id_date">Data</label>
    {{ form.date }}
  </div>
  <div class="mb-3">
    <label class="form-label" for="id_amount">Valor</label>
    {{ form.amount }}
  </div>
  <div class="mt-3 d-flex gap-2">
    <a href="{% url 'finance:invoice_detail' invoice_id %}" class="btn btn-secondary">Cancelar</a>
    <button type="submit" class="btn btn-primary">Salvar</button>
  </div>
</form>

<script>
  (function() {
    const kind = document.getElementById('id_kind');
    const accountWrapper = document.getElementById('account-field');
    const account = document.getElementById('id_account');
    function toggleAccount() {
      const isDiscount = kind && kind.value === 'DISCOUNT';
      if (accountWrapper) accountWrapper.style.display = isDiscount ? 'none' : '';
      if (account) {
        if (isDiscount) {
          account.removeAttribute('required');
          account.value = '';
        } else {
          account.setAttribute('required', 'required');
        }
      }
    }
    if (kind) {
      kind.addEventListener('change', toggleAccount);
      toggleAccount();
    }
  })();
  </script>
{% endblock %}
